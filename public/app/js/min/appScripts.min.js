var myAppModule=angular.module("myApp",[]);myAppModule.config(["$routeProvider","$httpProvider",function($routeProvider){$routeProvider.when("/",{templateUrl:"./html/chat.html",controller:"ChatController"}).otherwise({templateUrl:"./html/search.html",controller:"SearchController"})}]),myAppModule.controller("ChatController",["$scope","$http","ChatService",function($scope,$http,ChatService){$scope.allContacts=[],$scope.getAllContactsInformation=[],$scope.messages=[],$scope.notificationIds=[],$scope.contacts=function(){var getContactsQuery=ChatService.getAllContacts();getContactsQuery.then(function(response){$scope.allContacts=response.data.contacts,$scope.getContactsInformation()})},$scope.contacts(),$scope.getContactsInformation=function(){for(var getContactsInformationQuery,i=0;i<$scope.allContacts.length;i++)getContactsInformationQuery=ChatService.getAllContactsInformation($scope.allContacts[i]),getContactsInformationQuery.then(function(response){response.data.contact.notification=!1,$scope.getAllContactsInformation.push(response.data.contact)})},$scope.showMessages=function(contact){var messagesQuery=ChatService.getChatHistory(contact.id);$scope.contact=contact,$scope.selectedItem=contact.id,$scope.displayNotification(contact.id,!0),$scope.name=contact.name,$scope.contactNumber=contact.phone,$scope.id=contact.id,messagesQuery.then(function(response){$scope.messages=response.data.messages})},$scope.sendMessage=function(){var obj={};obj.id=$scope.id,obj.content=$scope.messageText;var sendMessageQuery=ChatService.sendMessage(obj);sendMessageQuery.then(function(response){$scope.messages.push(response.data.message),$scope.messageText=""})},$scope.getNotificationIds=function(){var notificationsQuery=ChatService.getNotificationIds();notificationsQuery.then(function(response){for(var key in response.data.notifications)$scope.displayNotification(key),$scope.contact.id===key&&$scope.showMessages($scope.contact)})},$scope.displayNotification=function(key,clicked){for(var i=0;i<$scope.getAllContactsInformation.length;i++)$scope.getAllContactsInformation[i].id===key&&(clicked||$scope.id==key?$scope.getAllContactsInformation[i].notification=!1:$scope.getAllContactsInformation[i].notification=!0)},setInterval($scope.getNotificationIds,5e3)}]),myAppModule.service("ChatService",function($http,$q){return this.getAllContacts=function(){var url="/api/contacts",promise=$q.defer().promise;return promise=$http.get(url)},this.getAllContactsInformation=function(id){var url="/api/contacts/"+id,promise=$q.defer().promise;return promise=$http.get(url)},this.getChatHistory=function(id){var url="/api/contacts/"+id+"/messages",promise=$q.defer().promise;return promise=$http.get(url)},this.sendMessage=function(obj){var promise=$q.defer().promise,post={};post.content=obj.content;var postUrl="/api/contacts/"+obj.id+"/messages";return promise=$http.post(postUrl,post)},this.getNotificationIds=function(){var url="/api/notifications",promise=$q.defer().promise;return promise=$http.get(url)},this});